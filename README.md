# Flashcard Lambda Project

## Overview

This project consists of an AWS Lambda function that automates the process of sending selected slides from a PowerPoint presentation as WhatsApp messages. The function operates on a schedule, running every 4 hours, and leverages AWS S3 for storage and Twilio for sending messages.

## Architecture

1. **AWS Lambda Function**: Executes the logic for downloading the PowerPoint file, processing slides, and sending WhatsApp messages.
2. **AWS S3**: Stores the PowerPoint file and processed slide images.
3. **Twilio**: Sends WhatsApp messages containing slide images.
4. **Amazon EventBridge**: Triggers the Lambda function every 4 hours.

## Prerequisites

- AWS account with permissions to use Lambda, S3, and EventBridge.
- Twilio account with a WhatsApp-enabled number.
- Java 17+ and Maven installed on your local development machine.

## Setup Instructions

### 1. Configure AWS S3

1. **Create an S3 Bucket**:
    - Navigate to the S3 console.
    - Create a bucket and note its name. This bucket will store the PowerPoint file and the processed images.

2. **Upload the PowerPoint File**:
    - Upload your PowerPoint file (`aws_test.pptx`) to the bucket.

### 2. Configure Twilio

1. **Create a Twilio Account**:
    - Sign up or log in to [Twilio](https://www.twilio.com/).

2. **Set Up WhatsApp Messaging**:
    - Obtain your Twilio Account SID and Auth Token from the Twilio console.
    - Configure a WhatsApp-enabled phone number.

### 3. Deploy the Lambda Function

1. **Set Up Environment Variables**:
    - `S3_BUCKET_NAME`: Name of your S3 bucket.
    - `TWILIO_ACCOUNT_SID`: Your Twilio Account SID.
    - `TWILIO_AUTH_TOKEN`: Your Twilio Auth Token.
    - `TWILIO_WHATSAPP_NUMBER`: Your Twilio WhatsApp-enabled number.
    - `TO_WHATSAPP_NUMBER`: The recipient’s WhatsApp number (formatted as `whatsapp:+1234567890`).

2. **Build the Lambda Function**:
    - Navigate to your project directory.
    - Run `mvn clean package` to build the project.

3. **Create the Lambda Function**:
    - Go to the Lambda console.
    - Create a new function and upload the JAR file generated by Maven (`target/your-jar-file.jar`).
    - Set the handler to `com.varshadas.demo.FlashcardLambda::handleRequest`.

4. **Configure Lambda Permissions**:
    - Ensure the Lambda function has permission to access S3 and send messages through Twilio.

### 4. Schedule Lambda Execution with EventBridge

1. **Create a Rule**:
    - Go to the EventBridge console.
    - Create a new rule with a schedule expression (`rate(4 hours)`).
    - Add the Lambda function as the target of the rule.

## Code Explanation

### Main Class: `FlashcardLambda`

- **Imports**: The necessary AWS SDK, Twilio SDK, Apache POI, and SLF4J libraries.
- **Environment Variables**: Loaded for S3 and Twilio configurations.
- **Method `handleRequest`**: Main entry point triggered by EventBridge. Handles file downloading, slide processing, and message sending.
- **Slide Processing**: Downloads the PowerPoint file, converts selected slides to images, uploads images back to S3, and sends them via WhatsApp.
- **Logging**: Uses SLF4J for logging the function’s progress and errors.

### Helper Methods

- **`isSlidesPreprocessed`**: Checks if slides have been processed today.
- **`markSlidesAsProcessed`**: Marks slides as processed in S3.
- **`downloadFileFromS3`**: Downloads a file from S3.
- **`preprocessSlides`**: Converts slides to images and uploads them to S3.
- **`sendWhatsAppMessage`**: Sends a WhatsApp message with the slide image.
- **`generateS3Url`**: Generates a URL for the image stored in S3.

## Testing Locally

1. **Mock Context**:
    - A mock context class (`TestContext`) is provided for local testing.
2. **Run Main Method**:
    - Execute the `main` method to test the Lambda function locally with a mock event.

## Error Handling

- The Lambda function logs errors for troubleshooting. Check the Lambda logs in CloudWatch for detailed error messages.

## Future Enhancements

- Implement error handling for network issues and API rate limits.
- Add more sophisticated slide selection logic based on user preferences.

